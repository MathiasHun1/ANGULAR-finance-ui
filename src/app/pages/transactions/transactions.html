<div class="page-title-container  d-flex justify-content-between align-items-center">
  <h1 class="page-title">{{"app.pages.transactions.title" | translate}}</h1>
  <button class="btn btn-dark px-3 pe-4 py-2 py-lg-3" (click)="openModal()">
    + {{"app.shared.buttonAdd" | translate}} <span class="d-none d-sm-inline">{{"app.pages.transactions.buttonAddSpan" |
      translate}}</span>
  </button>
</div>

@if (!paginatedData()) {
<p class="h2 text-center py-5">Loading..</p>
} @else {

<div class="custom-card d-flex flex-column justify-content-between text-grey-500 px-5">
  <!-- Input fields -->
  <div class="input-section row pt-2 pb-3">
    <div class="col-9 col-md-6 pe-0">
      <input type="text" class="form-control search-input" placeholder="Search transaction"
        [(ngModel)]="searchFieldValue" />
    </div>

    <div class="col row ">
      <!-- Only mobile input fields  -->
      <div class="sort-icons-container d-flex gap-3 px-0 pe-2 justify-content-end">
        <button class="btn p-0 m-0 d-md-none d-md-grid align-self-center" (click)="toggleMobileSortOpen()">
          <img src="/images/icon-sort-mobile.svg" alt="">
        </button>
        <button class="btn p-0 m-0 d-md-none d-md-grid align-self-center" (click)="toggleMobileCategorySelectOpen()">
          <img src="/images/icon-filter-mobile.svg" alt="">
        </button>

        @if (mobileSortOpen()) {

        <!-- Sorting options popup -->
        <ul class="sort-popup--order px-3 list-group fs-7" #mobileSortMenu>
          <li class=" list-group-item">{{"app.pages.transactions.labelSorting" | translate}}</li>
          <li class="list-group-item pe-5" [ngClass]="{'fw-bold text-black': sortValue() === 'date'}"
            (click)="clickOnSortOption('date')">Latest</li>
          <li class="list-group-item pe-5" [ngClass]="{'fw-bold text-black': sortValue() === 'dateReverse'}"
            (click)="clickOnSortOption('dateReverse')">Oldest
          </li>
          <li class="list-group-item pe-5" [ngClass]="{'fw-bold text-black': sortValue() === 'name'}"
            (click)="clickOnSortOption('name')">A - Z</li>
          <li class="list-group-item pe-5" [ngClass]="{'fw-bold text-black': sortValue() === 'nameReverse'}"
            (click)="clickOnSortOption('nameReverse')">Z - A
          </li>
          <li class="list-group-item pe-5" [ngClass]="{'fw-bold text-black': sortValue() === 'amount'}"
            (click)="clickOnSortOption('amount')">Highest</li>
          <li class="list-group-item pe-5" [ngClass]="{'fw-bold text-black': sortValue() === 'amountReverse'}"
            (click)="clickOnSortOption('amountReverse')">Oldest
          </li>
        </ul>
        }

        <!-- Category select popup -->
        @if (mobileCategorySelectOpen()) {
        <ul class="sort-popup--order px-3 list-group fs-7" #categorySelectMenu>
          <li class=" list-group-item">{{"app.pages.transactions.labelFilter" | translate}}</li>
          <li class="list-group-item pe-5" [ngClass]="{'fw-bold': categoryValue() === ''}"
            (click)="categoryValue.set('')">All</li>

          @for (category of categories(); track category) {
          <li class="list-group-item " [ngClass]="{'fw-bold': category === categoryValue()}"
            (click)="clickOnCategoryOption(category)">{{category}}</li>

          }
        </ul>
        }
      </div>


      <!-- Only desktop input fields  -->
      <div class="col d-none d-md-flex align-items-center text-nowrap gap-2">
        <label for="sortby">{{"app.pages.transactions.labelSorting" | translate}}</label>
        <select id="sortby" class="form-select" [(ngModel)]="sortValue">
          <option value="date">{{"app.shared.sortings.latest" | translate}}</option>
          <option value="dateReverse">{{"app.shared.sortings.oldest" | translate}}</option>
          <option value="name">A - Z</option>
          <option value="nameReverse">Z - A</option>
          <option value="amount">{{"app.shared.sortings.highest" | translate}}</option>
          <option value="amountReverse">{{"app.shared.sortings.lowest" | translate}}</option>
        </select>
      </div>

      <div class="col d-none d-md-flex align-items-center text-nowrap gap-2">
        <label for="category">{{"app.pages.transactions.labelFilter" | translate}}</label>
        <select id="category" class="form-select" [(ngModel)]="categoryValue">
          <option value="">All</option>
          @for (category of categories(); track category) {
          <option [value]="category">{{ category }}</option>
          }
        </select>
      </div>
    </div>
  </div>



  <div class="list-group ">
    <!-- Info line -->
    <div class="list-group-item d-none d-md-grid">
      <span>{{"app.pages.transactions.labelGroup1" | translate}}</span>
      <span>{{"app.pages.transactions.labelGroup2" | translate}}</span>
      <span>{{"app.pages.transactions.labelGroup3" | translate}}</span>
      <span class="amount">{{"app.pages.transactions.labelGroup4" | translate}}</span>
    </div>

    <!-- Transaction elements -->
    @for (transaction of paginatedData(); track transaction.id) {
    <div class="transaction-item list-group-item">
      <div class="d-flex ">
        <div class="avatar-container">
          <img [src]="transaction.avatar" alt="" class="profile-image rounded-circle" width="40" height="40" />
        </div>
        <div class="d-flex flex-column justify-content-center ms-2">
          <span class="fw-bold fs-7 text-black">
            {{ transaction.name }}
          </span>
          <span class="d-sm-none"> {{ transaction.category }} </span>
        </div>
      </div>

      <span class="d-none d-sm-inline"> {{ transaction.category }} </span>

      <span class="d-none d-sm-inline"> {{ transaction.date | date : "dd MMM yyyy" }} </span>

      <div class="d-flex flex-column justify-content-center align-items-end">
        <span class="amount" [ngClass]="{
            'text-green': transaction.amount >= 0,
            'text-black': transaction.amount < 0
          }">
          {{ transaction.amount | currency }}
        </span>
        <span class="d-sm-none"> {{ transaction.date | date : "dd MMM yyyy" }} </span>
      </div>

    </div>
    }
  </div>


  <!-- PAGINATION -->
  <!-- For more than 4 pages -->
  <nav aria-label="pagination controls" class="pt-4">
    <ul class="pagination d-flex justify-content-between">
      <li class="" (click)="stepPrevPage()">
        <div class="page-link stepper">
          <img class="arrow" src="/images/icon-caret-left.svg" alt="" />
          <span class="control-text">{{"app.pages.transactions.buttonPrev" | translate}}</span>
        </div>
      </li>
      <!-- Pages -->
      <div class="d-flex">
        @if (pageNumbers().length > 4) {
        <!-- If current page is 1 or 2 -->
        @if (currentPage() <= 2) { <li class="" (click)="stepToPage(1)">
          <span class="page-link" [ngClass]="{ active: 1 === currentPage() }">
            {{1}}
          </span>
          </li>

          <li class="" (click)="stepToPage(2)">
            <span class="page-link" [ngClass]="{ active: 2 === currentPage() }">
              {{2}}
            </span>
          </li>

          <li class="">
            <span class="page-link">
              ...
            </span>
          </li>

          <li class="" (click)="stepToPage(this.pageNumbers().length)">
            <span class="page-link">
              {{this.pageNumbers().length}}
            </span>
          </li>
          }
          <!-- If current page is between 2 and last-1 -->
          @if (currentPage() > 2 && currentPage() < pageNumbers().length - 1) { <li class=""
            (click)="stepToPage(currentPage() - 1)">
            <span class="page-link">
              {{currentPage() - 1}}
            </span>
            </li>

            <li class="" (click)="stepToPage(currentPage())">
              <span class="page-link active">
                {{currentPage()}}
              </span>
            </li>

            <li class="">
              <span class="page-link">
                ...
              </span>
            </li>

            <li class="" (click)="stepToPage(this.pageNumbers().length)">
              <span class="page-link">
                {{this.pageNumbers().length}}
              </span>
            </li>
            }

            <!-- If current page is last or last-1  -->
            @if (currentPage() >= pageNumbers().length - 1) {
            <li class="" (click)="stepToPage(1)">
              <span class="page-link ">
                {{1}}
              </span>
            </li>

            <li class="">
              <span class="page-link">
                ...
              </span>
            </li>

            <li class="">
              <span class="page-link" (click)="stepToPage(pageNumbers().length - 1)" [ngClass]="{
                    active: pageNumbers().length - 1 === currentPage()
                  }">
                {{pageNumbers().length - 1}}
              </span>
            </li>

            <li class="">
              <span class="page-link" [ngClass]="{
                    active: pageNumbers().length === currentPage()
                  }" (click)="stepToPage(pageNumbers().length)">
                {{pageNumbers().length}}
              </span>
            </li>
            }
            } @else {
            @for (number of pageNumbers(); track number) {
            <li class="" (click)="stepToPage(number)">
              <span class="page-link" [ngClass]="{ active: number === currentPage() }">
                {{ number }}
              </span>
            </li>
            }
            }
      </div>

      <li class="" (click)="stepNextPage()">
        <div class="page-link stepper">
          <span class="control-text">{{"app.pages.transactions.buttonNext" | translate}} </span>
          <img class="arrow" src="/images/icon-caret-right.svg" alt="" />
        </div>
      </li>
    </ul>
  </nav>
</div>
}